<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cute Animal Survival</title>
<style>
    body { font-family: sans-serif; text-align: center; background: #f0f8ff; }
    #login, #game { margin-top: 50px; }
    .bar { width: 300px; height: 20px; background: #ddd; margin: 10px auto; border-radius: 10px; overflow: hidden; }
    .fill { height: 100%; background: #4CAF50; width: 100%; transition: width 0.2s; }
    .animal-select img { width: 80px; cursor: pointer; margin: 10px; border: 3px solid transparent; border-radius: 10px; }
    .animal-select img.selected { border-color: #FF69B4; }
    button { margin: 5px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
</style>
</head>
<body>

<div id="login">
    <h2>Login / Signup</h2>
    <input type="password" id="passwordInput" placeholder="Enter password">
    <button onclick="login()">Start</button>

    <div id="animalChoice" style="display:none;">
        <h3>Choose your cute animal</h3>
        <div class="animal-select">
            <img src="https://i.imgur.com/Oy7B2Bz.png" alt="Cat" onclick="chooseAnimal('cat', this)">
            <img src="https://i.imgur.com/yzs2kqA.png" alt="Dog" onclick="chooseAnimal('dog', this)">
            <img src="https://i.imgur.com/hRtkGdf.png" alt="Bunny" onclick="chooseAnimal('bunny', this)">
        </div>
        <button onclick="confirmAnimal()">Confirm</button>
    </div>
</div>

<div id="game" style="display:none;">
    <h2 id="animalName"></h2>
    <img id="animalImg" src="" width="150">

    <div>
        <div>Hunger</div>
        <div class="bar"><div id="hungerBar" class="fill"></div></div>
        <div>Thirst</div>
        <div class="bar"><div id="thirstBar" class="fill" style="background:#1E90FF"></div></div>
        <div>Health</div>
        <div class="bar"><div id="healthBar" class="fill" style="background:#FF4500"></div></div>
    </div>

    <div>
        <h3>Resources</h3>
        Food: <span id="foodCount">0</span> | Water: <span id="waterCount">0</span>
    </div>

    <div>
        <button onclick="feed()">Feed</button>
        <button onclick="giveWater()">Give Water</button>
        <button onclick="upgradeGenerator('food')">Upgrade Food Generator</button>
        <button onclick="upgradeGenerator('water')">Upgrade Water Generator</button>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

// Firebase config
const firebaseConfig = {
    databaseURL: "https://lilguys-ae7fe-default-rtdb.firebaseio.com/"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let player = null;
let password = '';
let selectedAnimal = '';

function login() {
    password = document.getElementById('passwordInput').value.trim();
    if(!password) return alert("Enter a password");
    loadPlayer(password, (data) => {
        player = data;
        if(!player.animal) {
            document.getElementById('animalChoice').style.display = 'block';
        } else {
            startGame();
        }
    });
}

function chooseAnimal(animal, img) {
    selectedAnimal = animal;
    document.querySelectorAll('.animal-select img').forEach(i => i.classList.remove('selected'));
    img.classList.add('selected');
}

function confirmAnimal() {
    if(!selectedAnimal) return alert("Pick an animal!");
    player.animal = selectedAnimal;
    savePlayer();
    document.getElementById('animalChoice').style.display = 'none';
    startGame();
}

function startGame() {
    document.getElementById('login').style.display = 'none';
    document.getElementById('game').style.display = 'block';
    document.getElementById('animalName').innerText = player.animal.toUpperCase();
    document.getElementById('animalImg').src = getAnimalImg(player.animal);

    // Game loop
    setInterval(gameTick, 1000);
}

function getAnimalImg(animal) {
    switch(animal) {
        case 'cat': return "https://i.imgur.com/Oy7B2Bz.png";
        case 'dog': return "https://i.imgur.com/yzs2kqA.png";
        case 'bunny': return "https://i.imgur.com/hRtkGdf.png";
    }
}

function gameTick() {
    const now = Date.now();
    const delta = (now - player.lastUpdate) / 1000;
    
    // Hunger/Thirst decay
    player.hunger -= delta * 0.5;
    player.thirst -= delta * 0.5;
    if(player.hunger < 0) player.hunger = 0;
    if(player.thirst < 0) player.thirst = 0;

    // Health decay
    if(player.hunger === 0 || player.thirst === 0) {
        player.health -= delta * 1;
        if(player.health < 0) player.health = 0;
    }

    // Generators
    player.food += player.foodGeneratorLevel * delta * 0.5;
    player.water += player.waterGeneratorLevel * delta * 0.5;

    player.lastUpdate = now;
    savePlayer();

    // Update UI
    document.getElementById('hungerBar').style.width = player.hunger + '%';
    document.getElementById('thirstBar').style.width = player.thirst + '%';
    document.getElementById('healthBar').style.width = player.health + '%';
    document.getElementById('foodCount').innerText = Math.floor(player.food);
    document.getElementById('waterCount').innerText = Math.floor(player.water);

    if(player.health <= 0) alert("Your animal died!");
}

function feed() {
    if(player.food >= 1) {
        player.food -= 1;
        player.hunger += 20;
        if(player.hunger > 100) player.hunger = 100;
    }
}

function giveWater() {
    if(player.water >= 1) {
        player.water -= 1;
        player.thirst += 20;
        if(player.thirst > 100) player.thirst = 100;
    }
}

function upgradeGenerator(type) {
    if(type === 'food') player.foodGeneratorLevel += 1;
    if(type === 'water') player.waterGeneratorLevel += 1;
}

function savePlayer() {
    player.lastUpdate = Date.now();
    set(ref(db, 'players/' + password), player);
}

function loadPlayer(pass, callback) {
    get(ref(db, 'players/' + pass)).then(snapshot => {
        if(snapshot.exists()) {
            callback(snapshot.val());
        } else {
            callback({
                animal: null,
                hunger: 100,
                thirst: 100,
                health: 100,
                food: 0,
                water: 0,
                foodGeneratorLevel: 1,
                waterGeneratorLevel: 1,
                lastUpdate: Date.now()
            });
        }
    });
}
</script>

</body>
</html>
