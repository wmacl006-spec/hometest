<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cute Animal Survival</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Comfortaa:wght@500;600;700&display=swap" rel="stylesheet">

<style>
:root {
    --pink: #B00B55;
    --purple: #6a1b9a;
    --black: #0f0f0f;
    --white: #ffffff;
    --gray: #b5b5b5;
    --panel: #161616;
}

* { box-sizing: border-box; margin:0; padding:0; }

body {
    font-family: 'Inter', sans-serif;
    background: radial-gradient(circle at top, #1b1b1b, var(--black));
    color: var(--white);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 2rem;
}

.container {
    width: 100%;
    max-width: 800px;
    text-align: center;
}

h1, h2 {
    font-family: 'Comfortaa', sans-serif;
    color: var(--pink);
}

h1 { font-size: 2.5rem; margin-bottom: 1rem; }
h2 { font-size: 1.8rem; margin-bottom: 1rem; }

input, button {
    padding: 0.8rem;
    border-radius: 8px;
    border: 1px solid #242424;
    background: var(--panel);
    color: var(--white);
    font-size: 1rem;
    margin: 0.5rem;
}

button:hover {
    transform: translateY(-2px);
    border-color: var(--pink);
    box-shadow: 0 10px 24px rgba(176,11,85,0.25);
    cursor: pointer;
}

.bar { width: 300px; height: 20px; background: #222; margin: 10px auto; border-radius: 10px; overflow: hidden; }
.fill { height: 100%; width: 100%; transition: width 0.2s; }

.animal-select img { width: 80px; margin: 10px; cursor: pointer; border-radius: 10px; border: 3px solid transparent; }
.animal-select img.selected { border-color: var(--pink); }

#leaderboard { margin-top: 1rem; }
#leaderboard ol { list-style: decimal; padding-left: 1rem; color: var(--white); }

</style>
</head>
<body>

<div class="container">

    <h1>Cute Animal Survival</h1>

    <!-- Login / Signup -->
    <div id="login">
        <input type="password" id="passwordInput" placeholder="Enter password">
        <button id="startBtn">Start</button>

        <!-- Animal selection -->
        <div id="animalChoice" style="display:none; margin-top: 1rem;">
            <h2>Pick an animal & name it</h2>
            <div class="animal-select">
                <img src="https://i.imgur.com/Oy7B2Bz.png" alt="Cat" data-animal="cat">
                <img src="https://i.imgur.com/yzs2kqA.png" alt="Dog" data-animal="dog">
                <img src="https://i.imgur.com/hRtkGdf.png" alt="Bunny" data-animal="bunny">
            </div>
            <input type="text" id="nicknameInput" placeholder="Name your animal">
            <button id="confirmAnimalBtn">Confirm</button>
        </div>
    </div>

    <!-- Game -->
    <div id="game" style="display:none; margin-top: 2rem;">
        <h2 id="animalName"></h2>
        <img id="animalImg" src="" width="150">

        <div>
            <div>Hunger</div>
            <div class="bar"><div id="hungerBar" class="fill" style="background:#FF69B4;"></div></div>
            <div>Thirst</div>
            <div class="bar"><div id="thirstBar" class="fill" style="background:#6a1b9a;"></div></div>
            <div>Health</div>
            <div class="bar"><div id="healthBar" class="fill" style="background:#B00B55;"></div></div>
        </div>

        <div>
            <h3>Resources</h3>
            Food: <span id="foodCount">0</span> | Water: <span id="waterCount">0</span>
        </div>

        <div>
            <button id="feedBtn">Feed</button>
            <button id="waterBtn">Give Water</button>
            <button id="upgradeFoodBtn">Upgrade Food Generator</button>
            <button id="upgradeWaterBtn">Upgrade Water Generator</button>
        </div>

        <!-- Leaderboard -->
        <h2>Leaderboard</h2>
        <div id="leaderboard"></div>
        <button onclick="updateLeaderboard()">Refresh Leaderboard</button>
    </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

// Firebase config
const firebaseConfig = {
    databaseURL: "https://lilguys-ae7fe-default-rtdb.firebaseio.com/"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let player = null;
let password = '';
let selectedAnimal = '';

// --- Event Listeners ---
document.getElementById('startBtn').addEventListener('click', login);
document.getElementById('confirmAnimalBtn').addEventListener('click', confirmAnimal);
document.getElementById('feedBtn').addEventListener('click', feed);
document.getElementById('waterBtn').addEventListener('click', giveWater);
document.getElementById('upgradeFoodBtn').addEventListener('click', () => upgradeGenerator('food'));
document.getElementById('upgradeWaterBtn').addEventListener('click', () => upgradeGenerator('water'));
document.querySelectorAll('.animal-select img').forEach(img => {
    img.addEventListener('click', () => chooseAnimal(img.dataset.animal, img));
});

// --- Functions ---
function login() {
    password = document.getElementById('passwordInput').value.trim();
    if(!password) return alert("Enter a password");
    loadPlayer(password, (data) => {
        player = data;
        if(!player.animal) document.getElementById('animalChoice').style.display = 'block';
        else startGame();
    });
}

function chooseAnimal(animal, img) {
    selectedAnimal = animal;
    document.querySelectorAll('.animal-select img').forEach(i => i.classList.remove('selected'));
    img.classList.add('selected');
}

function confirmAnimal() {
    const nickname = document.getElementById('nicknameInput').value.trim();
    if(!selectedAnimal) return alert("Pick an animal!");
    if(!nickname) return alert("Enter a nickname!");
    player.animal = selectedAnimal;
    player.nickname = nickname;
    player.startTime = Date.now();
    savePlayer();
    document.getElementById('animalChoice').style.display = 'none';
    startGame();
}

function startGame() {
    document.getElementById('login').style.display = 'none';
    document.getElementById('game').style.display = 'block';
    document.getElementById('animalName').innerText = `${player.nickname} (${player.animal.toUpperCase()})`;
    document.getElementById('animalImg').src = getAnimalImg(player.animal);
    setInterval(gameTick, 1000);
}

function getAnimalImg(animal) {
    switch(animal) {
        case 'cat': return "https://i.imgur.com/Oy7B2Bz.png";
        case 'dog': return "https://i.imgur.com/yzs2kqA.png";
        case 'bunny': return "https://i.imgur.com/hRtkGdf.png";
    }
}

function gameTick() {
    const now = Date.now();
    const delta = (now - player.lastUpdate) / 1000;

    player.hunger -= delta * 0.5;
    player.thirst -= delta * 0.5;
    if(player.hunger < 0) player.hunger = 0;
    if(player.thirst < 0) player.thirst = 0;

    if(player.hunger === 0 || player.thirst === 0) {
        player.health -= delta * 1;
        if(player.health < 0) player.health = 0;
    }

    player.food += player.foodGeneratorLevel * delta * 0.5;
    player.water += player.waterGeneratorLevel * delta * 0.5;

    player.lastUpdate = now;
    savePlayer();

    // Update UI
    document.getElementById('hungerBar').style.width = player.hunger + '%';
    document.getElementById('thirstBar').style.width = player.thirst + '%';
    document.getElementById('healthBar').style.width = player.health + '%';
    document.getElementById('foodCount').innerText = Math.floor(player.food);
    document.getElementById('waterCount').innerText = Math.floor(player.water);

    if(player.health <= 0) {
        alert(`${player.nickname} has died!`);
        set(ref(db, 'leaderboard/' + password), {
            nickname: player.nickname,
            survivalTime: Date.now() - player.startTime
        });
        return;
    }
}

function feed() {
    if(player.food >= 1) {
        player.food -= 1;
        player.hunger += 20;
        if(player.hunger > 100) player.hunger = 100;
    }
}

function giveWater() {
    if(player.water >= 1) {
        player.water -= 1;
        player.thirst += 20;
        if(player.thirst > 100) player.thirst = 100;
    }
}

function upgradeGenerator(type) {
    if(type === 'food') player.foodGeneratorLevel += 1;
    if(type === 'water') player.waterGeneratorLevel += 1;
}

function savePlayer() {
    player.lastUpdate = Date.now();
    set(ref(db, 'players/' + password), player);
}

function loadPlayer(pass, callback) {
    get(ref(db, 'players/' + pass)).then(snapshot => {
        if(snapshot.exists()) callback(snapshot.val());
        else callback({
            animal: null,
            hunger: 100,
            thirst: 100,
            health: 100,
            food: 0,
            water: 0,
            foodGeneratorLevel: 1,
            waterGeneratorLevel: 1,
            lastUpdate: Date.now()
        });
    });
}

// Leaderboard
function updateLeaderboard() {
    get(ref(db, 'leaderboard/')).then(snapshot => {
        const data = snapshot.val();
        if(!data) return;
        const arr = Object.values(data).sort((a,b) => b.survivalTime - a.survivalTime);
        let html = '<ol>';
        arr.forEach(entry => {
            const seconds = Math.floor(entry.survivalTime/1000);
            html += `<li>${entry.nickname} - ${seconds}s</li>`;
        });
        html += '</ol>';
        document.getElementById('leaderboard').innerHTML = html;
    });
}
</script>

</body>
</html>
